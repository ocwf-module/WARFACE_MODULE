# Экспорт уровня из WF MOD SDK 1.4.5 | Импортирование карты в кастомный клиент (сервер) WARFACE

После того, как вы создали свою карту или модифицировали существующую в WF MOD SDK, вам явно захочется на ней поиграть и проверить её на работоспособность, ведь сам редактор в полной мере не позволяет этого сделать из-за своих особенностей, и максимум, что в нём можно сделать, это в режиме игры пробежаться по ней. Здесь же вы узнаете, как импортировать карту в Warface, чтобы на ней можно было поиграть, пострелять, активировать ваши пасхалки и т. д.

## Процесс экспорта в клиент

Для начала вам необходимо получить саму карту. Так как Warface не понимает CRY-файлы движка, ему необходимы PAK-архивы, которые будут содержать в себе данные с информацией о карте. Чтобы их получить, необходимо:

1. Зайти в редактор и запустить свою карту, которую вы будете импортировать в игру;
2. В верхней панели перейдите в \[File —> Generate Surface Texture\] и выберете размеры вашей текстуры Terrain (ставьте 4096x4096 и не парьтесь, так как больше всё равно нет), далее ставьте галочку напротив пункта \[High Quality\], а в пункте \[Terrain Color Multiplier\] ставьте значение \[8\]. Также, если вы хотите получить более качественные тени, текстуру ландшафта и вообще улучшить картинку, то ставьте галочку напротив пункта \[Calculate Terrain Sky Accessibility\], но учтите, что последущая обработка гораздо замедлит процесс экспорта. Нажимаете \[Ок\] и ждёте завершения процесса;
3. После того, как вы убедились, что на карте всё есть и вы ничего не забыли, в верхней панели переходите и нажимаете на \[File —> Save\] и \[File —> Export to Engine\];
4. После завершения процесса можете закрыть редактор.

Из того, что лежит в папке с вашей картой вам понадобится:

1. Архив \[level.pak\] — главный архив, в нём хранится почти вся информация уровня;
2. Архив \[terraintexture.pak\] — содержит данные о текстуре террейна, которые сохраняются при «Generate Surface Textures» в редакторе (как выяснилось, для Warface он в принципе не нужен, но разработчики всё ещё закидывают его в файлы. Почему? Не знаю);
3. Файл \[filelist.xml\] — сохраняет информацию (MD5-хэш и размер) о критически важных файлах (\[level.pak\], \[Level_Name.dds\] и \[Level_Name.xml\]). Выполняется в процессе «Export to Engine» (используется для защиты клиента и для запуска карты сервером);
4. Файл \[tags.txt\] — когда вы создаете местоположения камер в редакторе (CTRL + F1-F12), эти местоположения сохраняются внутри этого файла (файл создаётся, даже если у вас нет подобных камер);
5. Файл \[Level_Name.dds\] — изображение мини-карты вашего уровня (имеется только если вы генерировали мини-карту). Подробная инструкция по созданаю мини-карты: "Create_MiniMap";
6. Файл \[Level_Name.xml\] — этот файл определяет информацию для отображения мини-карты (имеется только если вы генерировали мини-карту). Подробная инструкция по созданаю мини-карты: "Create_MiniMap";

Также вам нужно создать самому несколько файлов:

7. Файл \[level.cfg\] — конфигурационный файл, который содержит квары (команды для движка и игры), которые будут выполняться только при запуске именно на эту карту (если у вас нет подобных идей, то его можно не создавать). Его пример можно увидеть на скриншоте;

![image](https://github.com/user-attachments/assets/ce674598-a0f4-4662-80b2-dca20b1c5b64)

8. Файл \[Objectives.xml\] — содержит локализацию или её ключи всплывающих текстов во время игры (например, «Раунд начался», «Бомба установлена» и т.д.). Как он устроен показано в прикреплённом изображении ниже, на примере него можно сделать свой;

![image](https://github.com/user-attachments/assets/73e241d8-fc9c-4f78-95a1-11bf257dddef)

9. Файл \[submissionconfig.xml\] — содержит значения требований для получения наград, а также сами значения наград в случае победы, поражения или ничьей (используется в основном для PvE-миссий и спецопераций, для PvP эти значения прописывают в файле с инструкцией для сервера, но игра всё равно будет требовать наличие именно данного файла. Как он устроен, можно найти в файлах игры и на примере их сделать свой). Если у вас PvP-карта, то можете прописать только первую и третью строчку, как на втором скриншоте, а между ними оставить пустоту;

![image](https://github.com/user-attachments/assets/4fcb92fb-f06b-4ef5-a708-b1aa935c587d)

![image](https://github.com/user-attachments/assets/9c7f7eb8-e6d8-40d3-bf19-0f78c7081408)

Все файлы, указанные выше, должны храниться по пути \[Game/Levels/ПУТЬ_ДО_ВАШЕЙ_КАРТЫ/ВАША_КАРТА/\], учтите \[ПУТЬ_ДО_ВАШЕЙ_КАРТЫ\] должен быть такой же, как расположена карта у вас в папке \[Levels\] в редакторе на момент сохранения. Все файлы, кроме \[level.pak\] и \[terraintexture.pak\], вы должны поместить по тому же пути в PAK-архиве. Например, \[Z_Levels.pak/Levels/ПУТЬ_ДО_ВАШЕЙ_КАРТЫ/ВАША_КАРТА/submissionconfig.xml\]). \[level.pak\] и \[terraintexture.pak\] кидаете напрямую в папку \[Levels\] в клиенте. Ваш PAK-архив с файлами карты, вам необходимо поместить в папку \[Game\] вашего игрового клиента. Инструкция по созданию PAK-архива: "Create_PAK".

Учтите! Ваши архивы с файлами должны быть по алфавиту в самом низу папки \[Game\], для этого называйте свои архивы, начиная с буквы \[Z\]. Игра загружает в последнюю очередь те архивы, которые находятся внизу по алфавиту, данные архивы имеют более высокий приоритет, если вдруг окажется, что у вас есть файл, который совпадает с основным клиентом.

На этом добавление карты в клиент завершено, вы даже можете её запустить, например, используя MVM, и снять на ней какой-нибудь красивый ролик ;)

## Процесс экспорта на сервер

Для добавления карты на свой сервер (эмулятор) вам необходимо сделать ещё кое-какие действия. А именно:
1. Создать файл \[Level_Name.xml\], который будет храниться в клиенте и на сервере по пути — [/libs/missions/\], на сервере (эмуляторе) путь может отличаться, но он точно будет содержать данный отрезок пути. В данном файле вы прописываете параметры карты, чтобы сервер знал: как называется карта, режим, в котором её запускать, её уникальный UID, доступна ли она в игре, можно ли её запускать в клановых битвах, на каких каналах она доступна, её локализация и иконки, награды и какую вообще карту нужно запускать. Пример, как выглядит файл, можно увидеть на скриншоте ниже. Для PvP и PvE файл имеет разный вид, но идея у них одна — дать игре инструкцию по запуску и завершению карты, а также по её отображению в клиенте. Инструкция по созданию данного файла: "Create_Server_XML";
2. Добавить карту в ротацию быстрой игры. В клиенте и на сервере ротация быстрой игры определяется файлом \[quickplay_maps.xml\]. Сюда вписывается название файла, который мы создавали выше, и режим, в разделе которого она будет находиться.
3. Ну и также перекинуть все файлы, которые вы создавали и получили, только уже не в архиве, а как обычные файлы в папку сервера (эмулятора). Ищете на сервере (эмуляторе) папку \[Levels\] и добавляете туда тот же путь до вашей карты, как в клиенте, и кидаете туда данные файлы.

## Подведение итогов

На этом импорт карты в игру завершён. Можете играть на ней или продолжить редактировать дальше, изучать создание карт более подробнее и добавлять на неё новые функции.

Официальная статья CryEngine 3 про файлы уровня: https://www.cryengine.com/docs/static/engines/cryengine-3/categories/1638401/pages/1605643

