# Импортирование и настройка содержимого уровня в редакторе

После того, как вы извлекли всё содержимое уровня, вам нужно всё это импортировать в редактор для воссоздания карты в нём. Здесь я буду ссылаться и продолжать смысл предыдущей инструкции «Mission_Extract», чтобы мне не пришлось придумывать ничего нового, а вам было проще воспринимать информацию. 

## Процесс импортирования

После действий из предыдущей инструкции у вас должна остаться папка с картой по пути: \[MSDK_Editor\Game\Levels\\] (предположим и разберём на примере карты \[tdm_downtown\]). После этапа с дампером я надеюсь, что вы отсортировали полученные в ходе его работы файлы в папке \[MSDK_Editor\Game\Levels\tdm_downtown\Setting\\], чтобы вам же было удобнее работать. Далее следуем инструкции:
1. Переименуйте папку с картой (в моём случае \[tdm_downtown\]) во что-то другое, например, просто добавьте единичку в конце (у меня это будет \[tdm_downtown1\]);
2. Далее открываем редактор \[MSDK_Editor\Bin64\Editor.exe\] и создаём новый уровень (в верхней панели File —> New);
	
 	2.1 Называем наш уровень оригинальным названием карты (в моём случае \[tdm_downtown\] уже без единички), именно поэтому к нашей папке с файлами мы добавляли единичку, так как если бы мы называли карту так же, как и папку с файлами, то редактор выдавал бы ошибку;
	
 	2.2 В пункте \[Heightmap Resolution\] мы выбираем тот размер Terrain, который указан в названии файла, который извлекал дампер до этого, а именно \[dump_terrain_***.raw\], на месте звёздочек будут цифры, которые соответствуют размеру стороны квадрата террейна (в моём случае файл имеет название \[dump_terrain_256.raw\], а это значит, что в пункте \[Heightmap Resolution\] нужно выбрать \[256x256\]);
	
 	2.3 В пункте \[Meters Per Unit\] всегда выбираем единицу;
	
 	2.4 Нажимаем \[Ok\];

![image](https://github.com/user-attachments/assets/2b2d273a-774e-4117-8d11-76f09b860e5b)

3. После создания уровня сохраняем его и закрываем редактор. Далее нужно перенести все файлы из папки \[tdm_downtown1\] в папку с сохранённым уровнем \[tdm_downtown\], после этого пустую папку можете удалить. Далее снова запускайте редактор и открывайте уровень \[tdm_downtown\].
4. После того как уровень загрузился, нам необходимо убрать с него воду (океан). Для этого ищем вкладку \[Edit Terrain\], нажимаем на неё и там во вкладке \[Modify\] нажимаем \[Remove Water\]. Вода нам не нужна, так как в основном на картах Warface используется кастомная вода.
5. А теперь приступаем к импортированию карты. Начнём с импортирования слоёв, так как нам надо увидеть, куда нам нужно прилететь, из-за того, что наша камера спавнится немного в другом месте (в большинстве своём вам нужно будет лететь в сторону нулевых координат). Для импортирования слоёв необходимо:

	5.1 В меню \[Rollup Bar\] перейти во вкладку \[Layers\];
	
	5.2 Нажать на иконку папки с названием \[Import Layers\];

	5.3 В появившемся окне найти нашу папку с файлами карты, а в ней уже файлы слоёв (в моём случае: \[MSDK_Editor\Game\Levels\tdm_downtown\Setting\Layers\\]);

	5.4 Выбрать (выделить) все файлы слоёв (файлы имеют расширение \[.lyr\]) нажатием \[Ctrl + A\] или мышкой;

	5.5 Нажать «Открыть» и ждать окончания загрузки;

6. После окончания загрузки ищем в пространстве наши объекты и летим к ним;
7. Далее нам нужно импортировать Terrain, но с ним есть небольшая заморочка, требуется вручную повернуть карту высот на 90 градусов против часовой стрелки с помощью графического редактора, поддерживающего работу с raw-файлами (к примеру, Photoshop):

	7.1 Ищем уже знакомый файл по пути в папке уровня \[Setting\Terrain\dump_terrain_***.raw\] и открываем его в любой программе, которая может работать с raw-файлами;
   
	7.2 Поворачиваем изображение на 90 градусов против часовой стрелки;
   
	7.3 Сохраняем по этому же пути с немного другим названием (например: \[dump_terrain_256_90.raw\]);
   
	7.4 В редакторе опять открываем вкладку \[Edit Terrain\], там во вкладке \[File\] нажимаем \[Import Heightmap\];
   
	7.5 Выбираем наш повёрнутый файл, нажимаем \[Открыть\] и ждём окончания загрузки;

8. Теперь к Terrain необходимо применить текстуру:

   	8.1 Перейдите во вкладку \[Edit Terrain Texture\];

   	8.2 Нажимаем на \[File\], а в нём на \[Import Layers...\];

   	8.3 В появившемся окне ищем файл, который извлёк CLC, по пути в папке уровня \[Setting\Terrain\TerrainLayerTexInfo.lay\];

	8.4 Жмём «Открыть», и у вас во вкладке «Edit Terrain Texture» появятся слои с текстурами Terrain, на карте, к сожалению, будет отображаться только одна (самая верхняя) текстура, так как на данный момент (не считая NUX MOD SDK) невозможно извлечь местоположение для каждого слоя. Этот верхний слой примет тот цвет, который содержится в архиве \[terraintexture.pak\]. Вам придётся самостоятельно восстановить рисунок;

9. Теперь импортируем Time Of Day (TOD), для этого:

	9.1 Во вкладке \[Terrain\] ищем пункт \[Time Of Day\] и нажимаем на него;
   
	9.2 В появившемся окне в меню \[Time of Day Tasks\] нажимаем на \[Import From File\];
   
	9.3 В появившемся окне ищем файл, который извлёк CLC, по пути в папке уровня \[Setting\TOD_and_Lighting\TimeOfDay.tod\];
   
	9.4 Нажимаем \[Открыть\] и ждём окончания загрузки;

10. Далее импортируем значения Lighting:

	10.1 Во вкладке \[Edit Terrain Lighting\] нажимаем \[Import\] и импортируем файл по пути в папке уровня \[Setting\TOD_and_Lighting\LightSettings.lgt\];

	10.2 А значение \[Time Of Day\] ставим такое же, как и в значении \[Time\] в первой строчке файла \[mission_mission0.xml\];

11. Теперь осталось ввести необходимые значения для придания карте почти истинного вида:

	11.1 В меню \[Rollup Bar\] перейти во вкладку \[Terrain\], а там нажимаем на \[Environment\];

	11.2 Открываем ранее открытый файл \[mission_mission0.xml\];

	11.3 Ищем в нём ветку \[\<Environment\>\] и переносим с неё все значения в редактор;


12. Ну и под конец, если вы захотите восстановить растительность на уровне, то сделайте это:

	12.1 В меню \[Rollup Bar\] перейти во вкладку \[Terrain\], а там нажимаем на \[Vegetation\];

	12.2 Нажимаем на иконку \[Import Vegetation\] и импортируем файл по пути в папке уровня \[Setting\Vegetation\VegetationObject.veg\];

	12.3 После этого у вас появится список объектов растительности, которые вам уже самим нужно будет расставить вручную, точные координаты каждого объекта можно найти в файле по пути в папке уровня \[Setting\Vegetation\veg_dump.txt\].

## Нюансы по анимированным и связанным объектам

У всех конверторов есть один недостаток, в файле \[level.pak\], а именно в \[mission_mission0.xml\] нет информации о связи сущности с другими сущностями (функция "Link Object") и поэтому сущности, которые были связаны с помощью "Link Object" и им были даны относительные, а не абсолютные координаты, конверторами понимаются как простые объекты, которые должны быть на заданных координатах. Связь хранится где-то в другом месте. Поэтому можно сказать, что конверторы пока очень плохо извлекают анимированные объекты и они с большой вероятностью будут поломаны.

## Подведение итогов

На этом импортирование карты подошло к концу. Теперь у вас на руках есть почти полноценный CRY-файл уровня, который вы можете легко редактировать и изучать. В следующей инструкции "Export_Mission" вы узнаете, как перенести карту в игру и поиграть на ней.

![image](https://github.com/user-attachments/assets/159fa2d3-b557-4d70-93c9-e1b8d84edc19)
